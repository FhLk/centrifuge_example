<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>Centrifugo Realtime Notification Test</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
      background: #f5f5f5;
    }
    h1 {
      font-size: 20px;
    }
    .status {
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 4px;
      background: #fff;
      border: 1px solid #ddd;
    }
    .status span {
      font-weight: bold;
    }
    #messages {
      margin-top: 10px;
      padding: 10px;
      border-radius: 4px;
      background: #fff;
      border: 1px solid #ddd;
      max-height: 400px;
      overflow-y: auto;
      font-size: 14px;
    }
    .msg-item {
      padding: 6px 8px;
      margin-bottom: 6px;
      border-radius: 4px;
      background: #eaf4ff;
    }
    .msg-time {
      font-size: 11px;
      color: #666;
    }
    .msg-data {
      margin-top: 2px;
      white-space: pre-wrap;
      word-break: break-all;
    }
    .controls {
      margin-bottom: 10px;
    }
    button {
      padding: 6px 12px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <h1>üîî Centrifugo Realtime Notification Test</h1>

  <div class="controls">
    <button id="btnConnect">Connect</button>
    <button id="btnDisconnect">Disconnect</button>
  </div>

  <div class="status">
    ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠: <span id="statusText">DISCONNECTED</span><br />
    Channel ‡∏ó‡∏µ‡πà subscribe: <code>announcement:global</code>
  </div>

  <div id="messages">
    <!-- ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° realtime ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ -->
  </div>

  <!-- JS client ‡∏Ç‡∏≠‡∏á Centrifugo ‡∏à‡∏≤‡∏Å CDN -->
  <script src="https://unpkg.com/centrifuge@<version>/dist/centrifuge.js"></script>

  <script>
    // URL ‡∏Ç‡∏≠‡∏á Centrifugo (‡∏ï‡∏≤‡∏° config ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì)
    const WS_URL = "ws://<domain_name>:30850/connection/websocket";
    const CHANNEL = "<channel_name>";

    let centrifuge = null;
    let subscription = null;

    const statusText = document.getElementById("statusText");
    const messagesDiv = document.getElementById("messages");
    const btnConnect = document.getElementById("btnConnect");
    const btnDisconnect = document.getElementById("btnDisconnect");

    function addMessage(text, data) {
      const item = document.createElement("div");
      item.className = "msg-item";

      const now = new Date();
      const time = document.createElement("div");
      time.className = "msg-time";
      time.textContent = now.toLocaleString();

      const body = document.createElement("div");
      body.className = "msg-data";
      if (data !== undefined) {
        body.textContent = text + " " + JSON.stringify(data, null, 2);
      } else {
        body.textContent = text;
      }

      item.appendChild(time);
      item.appendChild(body);
      messagesDiv.prepend(item);
    }

    function connect() {
      if (centrifuge) {
        addMessage("‚ö†Ô∏è Already connected or connecting...");
        return;
      }

      addMessage("üöÄ Connecting to " + WS_URL);

      centrifuge = new Centrifuge(WS_URL, {
      token : "<access_token>"
      });

      // Event: ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
      centrifuge.on('connected', function(ctx) {
        console.log("wow");
        statusText.textContent = "CONNECTED (clientID=" + ctx.client + ")";
        addMessage("‚úÖ Connected", ctx);
      });

      // Event: ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
      centrifuge.on('disconnect', function(ctx) {
        statusText.textContent = "DISCONNECTED (" + ctx.reason + ")";
        addMessage("‚ùå Disconnected", ctx);
      });

      // subscribe channel announcement:global
      subscription = centrifuge.newSubscription(CHANNEL);

      subscription.on('publication', function(ctx) {
        
        addMessage("üì¢ New message on " + CHANNEL + ":", ctx.data);
        console.log("New publication:", ctx);
        
      });

      subscription.on('subscribed', function(ctx) {
        addMessage("‚úÖ Subscribed to channel: " + CHANNEL, ctx);
      });

      subscription.on('unsubscribed', function(ctx) {
        addMessage("üö™ Unsubscribed from channel: " + CHANNEL, ctx);
      });

      subscription.on('error', function(err) {
        addMessage("‚ö†Ô∏è Subscription error on " + CHANNEL + ":", err);
      });

      subscription.subscribe();
      centrifuge.connect();
    }

    function disconnect() {
      if (!centrifuge) {
        addMessage("‚ö†Ô∏è Not connected.");
        return;
      }
      addMessage("üëã Disconnecting...");
      if (subscription) {
        subscription.unsubscribe();
        subscription = null;
      }
      centrifuge.disconnect();
      centrifuge = null;
      statusText.textContent = "DISCONNECTED";
    }

    btnConnect.addEventListener("click", connect);
    btnDisconnect.addEventListener("click", disconnect);

    // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ auto-connect ‡∏ï‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤ ‡πÉ‡∏´‡πâ uncomment ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ:
    // connect();
  </script>
</body>
</html>
